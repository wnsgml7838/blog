---
layout: default
---

<a href="#main-content" class="skip-to-content">본문으로 건너뛰기</a>

<div class="container">
  <div class="post-container">
    <div class="post-content-wrapper">
        <article class="post">
            <!-- Mobile TOC -->
            <nav class="post-toc-mobile" aria-label="모바일 목차">
                <button class="post-toc-mobile__toggle" id="mobile-toc-toggle" aria-expanded="false" aria-controls="mobile-toc-content">
                    목차
                </button>
                <div class="post-toc-mobile__content" id="mobile-toc-content">
                    <ul class="post-toc__list" id="mobile-toc-list">
                        <!-- Mobile TOC will be generated by JavaScript -->
                    </ul>
                </div>
            </nav>

            <header class="post-header">
                <h1 class="post-header__title">{{ page.title }}</h1>
                
                <div class="post-header__meta">
                    <div class="avatar avatar-md" aria-hidden="true">
                        {{ site.author.name | slice: 0 }}
                    </div>
                    <div style="display: flex; flex-direction: column; align-items: center; gap: 4px;">
                        <span style="font-weight: 500;">{{ page.author | default: site.author.name }}</span>
                        <div style="display: flex; align-items: center; gap: var(--spacing-xs); color: var(--color-text-secondary); font-size: var(--font-size-sm);">
                            <time datetime="{{ page.date | date_to_xmlschema }}">
                                {{ page.date | date: "%Y년 %m월 %d일" }}
                            </time>
                            <span aria-hidden="true">•</span>
                            <span>{{ content | number_of_words | divided_by: 200 | at_least: 1 }}분 읽기</span>
                        </div>
                    </div>
                </div>

                <div class="post-header__tags">
                    {% if page.categories.size > 0 %}
                        {% for category in page.categories %}
                            <span class="tag tag-primary">{{ category }}</span>
                        {% endfor %}
                    {% endif %}
                    {% if page.tags.size > 0 %}
                        {% for tag in page.tags %}
                            <span class="tag">{{ tag }}</span>
                        {% endfor %}
                    {% endif %}
                </div>
            </header>

            <main class="post-content" id="main-content">
                {{ content }}
            </main>
        </article>
    </div>
    
    <!-- Table of Contents (Desktop) - 오른쪽 사이드바 -->
    <aside class="post-toc" aria-label="목차">
        <div class="post-toc__title">목차</div>
        <ul class="post-toc__list" id="toc-list">
            <!-- TOC will be generated by JavaScript -->
        </ul>
    </aside>
  </div>
  
  <!-- 포스트 네비게이션 -->
  <nav class="post-navigation" aria-label="포스트 네비게이션">
      <div class="post-navigation__grid">
          {% if page.previous.url %}
              <a href="{{ page.previous.url | relative_url }}" class="card card-clickable post-navigation__link">
                  <div class="post-navigation__label">← 이전 포스트</div>
                  <div class="post-navigation__title">{{ page.previous.title }}</div>
              </a>
          {% else %}
              <div></div>
          {% endif %}

          {% if page.next.url %}
              <a href="{{ page.next.url | relative_url }}" class="card card-clickable post-navigation__link post-navigation__link--next">
                  <div class="post-navigation__label">다음 포스트 →</div>
                  <div class="post-navigation__title">{{ page.next.title }}</div>
              </a>
          {% else %}
              <div></div>
          {% endif %}
      </div>
  </nav>

  <!-- 관련 포스트 -->
  {% assign related_posts = site.related_posts | slice: 0, 3 %}
  {% if related_posts.size > 0 %}
  <section style="margin-top: var(--spacing-xxl);">
      <h3 class="text-h3" style="margin-bottom: var(--spacing-lg);">관련 포스트</h3>
      <div class="grid grid-3">
          {% for related_post in related_posts %}
              <a href="{{ related_post.url | relative_url }}" class="article-card">
                  <div class="article-card-title">{{ related_post.title }}</div>
                  <div class="article-card-description">
                      {{ related_post.excerpt | strip_html | truncatewords: 15 }}
                  </div>
                  <div class="article-card-meta">
                      <span>{{ related_post.date | date: "%Y.%m.%d" }}</span>
                      {% if related_post.tags.size > 0 %}
                          <span>•</span>
                          <span>{{ related_post.tags.first }}</span>
                      {% endif %}
                  </div>
              </a>
          {% endfor %}
      </div>
  </section>
  {% endif %}

  <!-- 댓글 섹션 -->
  {% include comments.html %}
</div>

<!-- TOC 자동 생성 및 모바일 토글 JavaScript -->
<script>
document.addEventListener('DOMContentLoaded', function() {
    // TOC 생성
    const tocList = document.getElementById('toc-list');
    const mobileTocList = document.getElementById('mobile-toc-list');
    const headings = document.querySelectorAll('.post-content h1, .post-content h2, .post-content h3, .post-content h4, .post-content h5, .post-content h6');
    
    if (headings.length > 0) {
        const tocItems = [];
        
        headings.forEach((heading, index) => {
            // 고유 ID 생성
            const id = `heading-${index}`;
            heading.id = id;
            
            const level = parseInt(heading.tagName.charAt(1));
            const text = heading.textContent.trim();
            
            const listItem = document.createElement('li');
            const link = document.createElement('a');
            link.href = `#${id}`;
            link.textContent = text;
            link.addEventListener('click', function(e) {
                e.preventDefault();
                heading.scrollIntoView({ behavior: 'smooth', block: 'start' });
                updateActiveTocItem(link);
            });
            
            listItem.appendChild(link);
            tocItems.push({ item: listItem, level: level, link: link });
        });
        
        // TOC 구조 생성 (중첩 목록)
        let currentList = tocList;
        let currentLevel = 1;
        
        tocItems.forEach(({ item, level, link }) => {
            if (level > currentLevel) {
                // 더 깊은 레벨
                const nestedList = document.createElement('ul');
                if (currentList.lastElementChild) {
                    currentList.lastElementChild.appendChild(nestedList);
                }
                currentList = nestedList;
                currentLevel = level;
            } else if (level < currentLevel) {
                // 더 얕은 레벨
                while (currentLevel > level && currentList.parentElement.parentElement.classList.contains('post-toc__list')) {
                    currentList = currentList.parentElement.parentElement;
                    currentLevel--;
                }
                currentLevel = level;
            }
            
            currentList.appendChild(item.cloneNode(true));
        });
        
        // 모바일 TOC 복사
        mobileTocList.innerHTML = tocList.innerHTML;
        
        // 활성 TOC 아이템 업데이트
        function updateActiveTocItem(activeLink) {
            document.querySelectorAll('.post-toc__list a').forEach(link => {
                link.classList.remove('active');
            });
            activeLink.classList.add('active');
            
            // 모바일 TOC에서도 동일한 링크 활성화
            const mobileLink = mobileTocList.querySelector(`a[href="${activeLink.getAttribute('href')}"]`);
            if (mobileLink) {
                mobileLink.classList.add('active');
            }
        }
        
        // 스크롤 시 활성 섹션 하이라이트
        const observer = new IntersectionObserver((entries) => {
            entries.forEach(entry => {
                if (entry.isIntersecting) {
                    const id = entry.target.id;
                    const tocLink = document.querySelector(`.post-toc__list a[href="#${id}"]`);
                    if (tocLink) {
                        updateActiveTocItem(tocLink);
                    }
                }
            });
        }, {
            rootMargin: '-20% 0px -60% 0px'
        });
        
        headings.forEach(heading => {
            observer.observe(heading);
        });
    } else {
        // 헤딩이 없으면 TOC 숨기기
        document.querySelector('.post-toc').style.display = 'none';
        document.querySelector('.post-toc-mobile').style.display = 'none';
    }
    
    // 모바일 TOC 토글
    const mobileToggle = document.getElementById('mobile-toc-toggle');
    const mobileContent = document.getElementById('mobile-toc-content');
    
    mobileToggle.addEventListener('click', function() {
        const isExpanded = this.getAttribute('aria-expanded') === 'true';
        this.setAttribute('aria-expanded', !isExpanded);
        this.classList.toggle('expanded');
        mobileContent.classList.toggle('expanded');
    });
});
</script>